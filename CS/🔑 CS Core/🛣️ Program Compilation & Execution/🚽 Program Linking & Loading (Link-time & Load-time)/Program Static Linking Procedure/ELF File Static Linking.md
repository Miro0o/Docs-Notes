# ELF File Static Linking

[TOC]



## Res
### Related Topics
â†— [ELF (Executable and Linkable Format)](../../../ğŸ¥·ğŸ¼%20Operating%20Systems%20&%20Kernels%20(Engineering%20Part)/Linux%20(Derived%20From%20UNIX%20Family)/ğŸ”©%20Linux%20Kernel/Linux%20IO%20&%20Files%20Management/ğŸ¤”%20Linux%20File%20System/Linux%20File%20Types%20&%20Formats/ELF%20(Executable%20and%20Linkable%20Format)/ELF%20(Executable%20and%20Linkable%20Format).md)
â†— [ELF File Layout & Format](../../../ğŸ¥·ğŸ¼%20Operating%20Systems%20&%20Kernels%20(Engineering%20Part)/Linux%20(Derived%20From%20UNIX%20Family)/ğŸ”©%20Linux%20Kernel/Linux%20IO%20&%20Files%20Management/ğŸ¤”%20Linux%20File%20System/Linux%20File%20Types%20&%20Formats/ELF%20(Executable%20and%20Linkable%20Format)/ELF%20File%20Layout%20&%20Format.md)



## Intro: ELF Static Linking
> ğŸ”— https://blog.csdn.net/jinking01/article/details/105388149?fromshare=blogdetail&sharetype=blogdetail&sharerId=105388149&sharerefer=PC&sharesource=weixin_43336330&sharefrom=from_link

é“¾æ¥è¿‡ç¨‹ä¸»è¦åŒ…å«äº†ä¸‰ä¸ªæ­¥éª¤ï¼š
1. **åœ°å€ä¸ç©ºé—´åˆ†é…ï¼ˆAddress and Storage Allocationï¼‰**
2. **ç¬¦å·è§£æï¼ˆSymbol Resolutionï¼‰**
3. **é‡å®šä½ï¼ˆRelocationï¼‰**

åœ¨Linuxä¸­ï¼Œé™æ€é“¾æ¥å™¨ï¼ˆstatic linkerï¼‰`ld`ä»¥ä¸€ç»„å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶å’Œå‘½ä»¤è¡Œå‚æ•°ä½œä¸ºè¾“å…¥ï¼Œç”Ÿæˆä¸€ä¸ªå®Œå…¨é“¾æ¥çš„ã€å¯ä»¥åŠ è½½å’Œè¿è¡Œçš„å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶ä½œä¸ºè¾“å‡ºã€‚è¾“å…¥çš„å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶ç”±å„ç§ä¸åŒçš„èŠ‚ç»„æˆï¼Œæ¯ä¸€èŠ‚éƒ½æ˜¯ä¸€ä¸ªè¿ç»­çš„å­—èŠ‚åºåˆ—ã€‚



## Address and Storage Allocation
> ğŸ”— https://blog.csdn.net/jinking01/article/details/105388149?fromshare=blogdetail&sharetype=blogdetail&sharerId=105388149&sharerefer=PC&sharesource=weixin_43336330&sharefrom=from_link

åœ¨ä»‹ç»ELFæ–‡ä»¶ç»“æ„å…³äºæ®µä¸èŠ‚çš„åŒºåˆ«æ—¶ï¼Œæˆ‘ä»¬å°±æåˆ°è¿‡å¯æ‰§è¡Œæ–‡ä»¶ä¸­çš„æ®µæ˜¯ç”±ç›®æ ‡æ–‡ä»¶ä¸­çš„èŠ‚åˆå¹¶è€Œæ¥çš„ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯ï¼šå¯¹äºå¤šä¸ªè¾“å…¥ç›®æ ‡æ–‡ä»¶ï¼Œé“¾æ¥å™¨å¦‚ä½•å°†å®ƒä»¬çš„å„ä¸ªèŠ‚åˆå¹¶åˆ°è¾“å‡ºæ–‡ä»¶å‘¢ï¼Ÿæˆ–è€…è¯´ï¼Œè¾“å‡ºæ–‡ä»¶ä¸­çš„ç©ºé—´å¦‚ä½•åˆ†é…ç»™è¾“å…¥æ–‡ä»¶ã€‚
1. **æŒ‰åºå åŠ **
	1. ![](../../../../../Assets/Pics/Pasted%20image%2020250329170728.png)
	2. è™½ç„¶è¿™ç§æ–¹æ³•éå¸¸ç®€å•ï¼Œä½†æ˜¯å®ƒå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šåœ¨æœ‰å¾ˆå¤šè¾“å…¥æ–‡ä»¶çš„æƒ…å†µä¸‹ï¼Œè¾“å‡ºæ–‡ä»¶ä¼šæœ‰å¾ˆå¤šé›¶æ•£çš„èŠ‚ã€‚è¿™ç§åšæ³•éå¸¸æµªè´¹ç©ºé—´ï¼Œå› ä¸ºæ¯ä¸ªèŠ‚éƒ½éœ€è¦æœ‰ä¸€å®šçš„åœ°å€å’Œç©ºé—´å¯¹é½è¦æ±‚ã€‚x86ç¡¬ä»¶çš„å¯¹é½è¦æ±‚æ˜¯4KBã€‚å¦‚æœä¸€ä¸ªèŠ‚çš„å¤§å°åªæœ‰1ä¸ªå­—èŠ‚ï¼Œå®ƒä¹Ÿè¦åœ¨å†…å­˜åœ¨é‡ç”¨4KBã€‚è¿™æ ·ä¼šé€ æˆå¤§é‡å†…éƒ¨ç¢ç‰‡ã€‚æ‰€ä»¥ä¸æ˜¯ä¸€ä¸ªå¥½çš„æ–¹æ¡ˆã€‚
2. **åˆå¹¶ç›¸ä¼¼èŠ‚**
	1. ä¸€ä¸ªæ›´åŠ å®é™…çš„æ–¹æ³•ä¾¿æ˜¯åˆå¹¶ç›¸åŒæ€§è´¨çš„èŠ‚ï¼Œæ¯”å¦‚ï¼šå°†æ‰€æœ‰è¾“å…¥æ–‡ä»¶çš„Â **`.text`èŠ‚**åˆå¹¶åˆ°è¾“å‡ºæ–‡ä»¶çš„Â **`text`æ®µ**ï¼ˆæ³¨æ„ï¼Œæ­¤æ—¶å‡ºç°äº†æ®µå’ŒèŠ‚ä¸¤ä¸ªæ¦‚å¿µï¼‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚
	2. ![](../../../../../Assets/Pics/Pasted%20image%2020250329170803.png)
	3. å…¶ä¸­`.bss`èŠ‚åœ¨ç›®æ ‡æ–‡ä»¶å’Œå¯æ‰§è¡Œæ–‡ä»¶ä¸­ä¸å ç”¨æ–‡ä»¶çš„ç©ºé—´ï¼Œä½†æ˜¯å®ƒåœ¨è£…è½½æ—¶å ç”¨åœ°å€ç©ºé—´ã€‚äº‹å®ä¸Šï¼Œè¿™é‡Œçš„**ç©ºé—´å’Œåœ°å€**æœ‰ä¸¤å±‚å«ä¹‰:
		1. åœ¨è¾“å‡ºçš„å¯æ‰§è¡Œæ–‡ä»¶ä¸­çš„ç©ºé—´
		2. åœ¨è£…è½½åçš„è™šæ‹Ÿåœ°å€ä¸­çš„ç©ºé—´
	4. å¯¹äºæœ‰å®é™…æ•°æ®çš„èŠ‚ï¼Œå¦‚`.text`å’Œ`.data`ï¼Œå®ƒä»¬åœ¨æ–‡ä»¶ä¸­å’Œè™šæ‹Ÿåœ°å€ä¸­éƒ½è¦åˆ†é…ç©ºé—´ï¼Œå› ä¸ºå®ƒä»¬åœ¨è¿™ä¸¤è€…ä¸­éƒ½å­˜åœ¨ï¼›å¯¹äº`.bss`æ¥ï¼Œåˆ†é…ç©ºé—´çš„æ„ä¹‰åªå±€é™äºè™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œå› ä¸ºå®ƒåœ¨æ–‡ä»¶ä¸­å¹¶æ²¡æœ‰å†…å®¹ã€‚**æˆ‘ä»¬åœ¨è¿™é‡Œè°ˆåˆ°çš„ç©ºé—´åˆ†é…åªå…³æ³¨äºè™šæ‹Ÿåœ°å€ç©ºé—´çš„åˆ†é…**ï¼Œå› ä¸ºè¿™å…³ç³»åˆ°é“¾æ¥å™¨åé¢çš„å…³äºåœ°å€è®¡ç®—çš„æ­¥éª¤ï¼Œè€Œå¯æ‰§è¡Œæ–‡ä»¶æœ¬èº«çš„ç©ºé—´åˆ†é…ä¸é“¾æ¥çš„å…³ç³»å¹¶ä¸å¤§ã€‚
### Two-Pass Linking
ç°åœ¨çš„é“¾æ¥å™¨ç©ºé—´åˆ†é…çš„ç­–ç•¥åŸºæœ¬ä¸Šéƒ½é‡‡ç”¨â€œåˆå¹¶ç›¸ä¼¼èŠ‚â€çš„æ–¹æ³•ï¼Œä½¿ç”¨è¿™ç§æ–¹æ³•çš„é“¾æ¥å™¨ä¸€èˆ¬é‡‡ç”¨ä¸€ç§å«Â **ä¸¤æ­¥é“¾æ¥ï¼ˆTwo-pass Linkingï¼‰**Â çš„æ–¹æ³•ã€‚å³æ•´ä¸ªé“¾æ¥è¿‡ç¨‹åˆ†ä¸ºä¸¤æ­¥ï¼š
- **ç¬¬ä¸€æ­¥ åœ°å€ä¸ç©ºé—´åˆ†é…** (Address and Storage Allocation)
    æ‰«ææ‰€æœ‰çš„è¾“å…¥ç›®æ ‡æ–‡ä»¶ï¼Œè·å¾—å®ƒä»¬çš„å„ä¸ªèŠ‚çš„é•¿åº¦ã€å±æ€§ã€ä½ç½®ï¼Œå¹¶å°†è¾“å…¥ç›®æ ‡æ–‡ä»¶ä¸­çš„ç¬¦å·è¡¨ä¸­æ‰€æœ‰çš„ç¬¦å·å®šä¹‰å’Œç¬¦å·å¼•ç”¨æ”¶é›†èµ·æ¥ï¼Œç»Ÿä¸€æ”¾åˆ°ä¸€ä¸ªå…¨å±€çš„ç¬¦å·è¡¨ã€‚è¿™ä¸€æ­¥ï¼Œé“¾æ¥å™¨èƒ½å¤Ÿè·å¾—æ‰€æœ‰è¾“å…¥ç›®æ ‡æ–‡ä»¶çš„èŠ‚çš„é•¿åº¦ï¼Œå¹¶å°†å®ƒä»¬åˆå¹¶ï¼Œè®¡ç®—å‡ºè¾“å‡ºæ–‡ä»¶ä¸­å„ä¸ªèŠ‚åˆå¹¶åçš„é•¿åº¦ä¸ä½ç½®ï¼Œå¹¶å»ºç«‹æ˜ å°„å…³ç³»ã€‚
- **ç¬¬äºŒæ­¥ ç¬¦å·è§£æä¸é‡å®šä½** (Symbol Resolution and Relocation)
    ä½¿ç”¨å‰ä¸€æ­¥ä¸­æ”¶é›†åˆ°çš„æ‰€æœ‰ä¿¡æ¯ï¼Œè¯»å–è¾“å…¥æ–‡ä»¶ä¸­èŠ‚çš„è¾“æ•°æ®ã€é‡å®šä½ä¿¡æ¯ï¼Œå¹¶ä¸”è¿›è¡Œç¬¦å·è§£æä¸é‡å®šä½ã€è°ƒæ•´ä»£ç ã€è°ƒæ•´ä»£ç ä¸­çš„åœ°å€ç­‰ã€‚äº‹å®ä¸Šï¼Œç¬¬äºŒæ­¥æ˜¯é“¾æ¥è¿‡ç¨‹çš„æ ¸å¿ƒï¼Œå°¤å…¶æ˜¯é‡å®šä½ã€‚

![](../../../../../Assets/Pics/Pasted%20image%2020250329171151.png)
åœ¨åœ°å€ä¸ç©ºé—´åˆ†é…æ­¥éª¤å®Œæˆä¹‹åï¼Œç›¸ä¼¼æƒé™çš„èŠ‚ä¼šè¢«åˆå¹¶æˆæ®µï¼Œå¹¶ç”Ÿæˆäº†[ELFæ–‡ä»¶ç»“æ„](http://chuquan.me/2018/05/21/elf-introduce/)ä¸€æ–‡ä¸­æ²¡æœ‰ä»‹ç»çš„Â **ç¨‹åºå¤´è¡¨ï¼ˆProgram Header Tableï¼‰**Â ç»“æ„ã€‚å¦‚ä¸‹å³å›¾å¯æ‰§è¡Œæ–‡ä»¶ç»“æ„æ‰€ç¤ºï¼Œä¸»è¦ç”Ÿæˆä¸¤ä¸ªæ®µï¼šä»£ç æ®µï¼ˆÂ `text`æ®µï¼‰ã€æ•°æ®æ®µï¼ˆÂ `data`æ®µ ï¼‰ã€‚

![](../../../../../Assets/Pics/Pasted%20image%2020250329171253.png)
æˆ‘ä»¬ä½¿ç”¨ldæˆ–gccå°†`a.o`å’Œ`b.o`é“¾æ¥èµ·æ¥ï¼Œç„¶åä½¿ç”¨objdumpå·¥å…·æ¥æŸ¥çœ‹é“¾æ¥å‰åçš„åœ°å€åˆ†é…æƒ…å†µã€‚

```
$ objdump -h a.o

Sections:
Idx Name          Size      VMA               LMA               File off  Algn
  0 .text         0000004f  0000000000000000  0000000000000000  00000040  2**0
                  CONTENTS, ALLOC, LOAD, RELOC, READONLY, CODE
  1 .data         00000000  0000000000000000  0000000000000000  0000008f  2**0
                  CONTENTS, ALLOC, LOAD, DATA
  2 .bss          00000000  0000000000000000  0000000000000000  0000008f  2**0
                  ALLOC
  
```

```
$ objdump -h b.o

Sections:
Idx Name          Size      VMA               LMA               File off  Algn
  0 .text         0000004b  0000000000000000  0000000000000000  00000040  2**0
                  CONTENTS, ALLOC, LOAD, READONLY, CODE
  1 .data         00000004  0000000000000000  0000000000000000  0000008c  2**2
                  CONTENTS, ALLOC, LOAD, DATA
  2 .bss          00000000  0000000000000000  0000000000000000  00000090  2**0
                  ALLOC
  ...
```

```
$ objdump -h ab

Sections:
Idx Name          Size      VMA               LMA               File off  Algn
  ...
  13 .text         00000202  0000000000400450  0000000000400450  00000450  2**4
                  CONTENTS, ALLOC, LOAD, READONLY, CODE
  ...
  24 .data         00000014  0000000000601028  0000000000601028  00001028  2**3
                  CONTENTS, ALLOC, LOAD, DATA
  25 .bss          00000004  000000000060103c  000000000060103c  0000103c  2**0
                  ALLOC
  ...
```

å¯ä»¥å‘ç°ï¼Œé“¾æ¥å‰ç›®æ ‡æ–‡ä»¶ä¸­æ‰€æœ‰èŠ‚çš„Â **VMAï¼ˆVirtual Memory Addressï¼‰**Â éƒ½æ˜¯0ï¼Œå› ä¸ºè™šæ‹Ÿç©ºé—´è¿˜æ²¡æœ‰åˆ†é…ã€‚é“¾æ¥åï¼Œå¯æ‰§è¡Œæ–‡ä»¶`ab`ä¸­å„ä¸ªèŠ‚è¢«åˆ†é…åˆ°äº†ç›¸åº”çš„è™šæ‹Ÿåœ°å€ï¼Œå¦‚`.text`èŠ‚è¢«åˆ†é…åˆ°äº†åœ°å€`0x0000000000400450`ã€‚

é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆé“¾æ¥å™¨è¦å°†å¯æ‰§è¡Œæ–‡ä»¶`ab`çš„`.text`èŠ‚åˆ†é…åˆ°`0x0000000000400450`ï¼Ÿè€Œä¸æ˜¯ä»è™šæ‹Ÿç©ºé—´çš„0åœ°å€å¼€å§‹åˆ†é…å‘¢ï¼Ÿè¿™æ¶‰åŠåˆ°**æ“ä½œç³»ç»Ÿçš„è¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´çš„åˆ†é…è§„åˆ™**ã€‚åœ¨LinuxÂ x86-64ç³»ç»Ÿä¸­ï¼Œä»£ç æ®µæ€»æ˜¯ä»`0x0000000000400000`å¼€å§‹çš„ï¼Œå¦å¤–`.text`èŠ‚ä¹‹å‰è¿˜æœ‰`ELF Header`ã€`Program Header Table`ã€`.init`ç­‰å ç”¨äº†ä¸€å®šçš„ç©ºé—´ï¼Œæ‰€ä»¥å°±è¢«åˆ†é…åˆ°äº†`0x0000000000400450`ã€‚



## Symbol Resolution
> ğŸ”— https://blog.csdn.net/jinking01/article/details/105388149?fromshare=blogdetail&sharetype=blogdetail&sharerId=105388149&sharerefer=PC&sharesource=weixin_43336330&sharefrom=from_link

åœ¨**ä¸¤æ­¥é“¾æ¥**ä¸­ï¼Œè¿™ä¸€æ­¥å’Œé‡å®šä½è¢«åˆå¹¶æˆäº†ä¸€æ­¥ï¼Œè¿™æ˜¯å› ä¸ºé‡å®šä½çš„è¿‡ç¨‹æ˜¯ä¼´éšç€ç¬¦å·è§£æçš„ã€‚è¿™é‡Œæˆ‘ä»¬åˆ†å¼€ä»‹ç»ã€‚

é“¾æ¥å™¨è§£æç¬¦å·å¼•ç”¨çš„æ–¹æ³•æ˜¯å°†æ¯ä¸ªå¼•ç”¨ä¸å®ƒè¾“å…¥çš„å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶çš„ç¬¦å·è¡¨ä¸­çš„ä¸€ä¸ªç¡®å®šçš„ç¬¦å·å®šä¹‰å…³è”èµ·æ¥ã€‚å¯¹é‚£äº›å’Œå¼•ç”¨å®šä¹‰åœ¨ç›¸åŒæ¨¡å—çš„å±€éƒ¨ç¬¦å·çš„å¼•ç”¨ï¼Œç¬¦å·è§£ææ˜¯éå¸¸ç®€å•çš„ã€‚ç¼–è¯‘å™¨åªå…è®¸æ¯ä¸ªæ¨¡å—ä¸­æ¯ä¸ªå±€éƒ¨ç¬¦å·æœ‰ä¸€ä¸ªå®šä¹‰ã€‚é™æ€å±€éƒ¨å˜é‡ä¹Ÿä¼šæœ‰æœ¬åœ°é“¾æ¥å™¨ç¬¦å·ï¼Œç¼–è¯‘å™¨è¿˜è¦ç¡®ä¿å®ƒä»¬æ‹¥æœ‰å”¯ä¸€çš„åå­—ã€‚

ç„¶è€Œï¼Œå¯¹äºå…¨å±€ç¬¦å·çš„è§£æè¦å¤æ‚å¾—å¤šã€‚å½“ç¼–è¯‘å™¨é‡åˆ°ä¸€ä¸ªä¸æ˜¯åœ¨å½“å‰æ¨¡å—ä¸­å®šä¹‰çš„ç¬¦å·ï¼ˆå˜é‡æˆ–å‡½æ•°åï¼‰æ—¶ï¼Œä¼šå‡è®¾è¯¥ç¬¦å·æ˜¯åœ¨å…¶ä»–æŸä¸ªæ¨¡å—ä¸­å®šä¹‰çš„ï¼Œç”Ÿæˆä¸€ä¸ªé“¾æ¥å™¨ç¬¦å·è¡¨æ¡ç›®ï¼Œå¹¶æŠŠå®ƒäº¤ç»™é“¾æ¥å™¨å¤„ç†ã€‚å¦‚æœé“¾æ¥å™¨åœ¨å®ƒçš„ä»»ä½•è¾“å…¥æ¨¡å—ä¸­éƒ½æ‰¾ä¸åˆ°è¿™ä¸ªè¢«å¼•ç”¨ç¬¦å·çš„å®šä¹‰ï¼Œå°±è¾“å‡ºä¸€æ¡é”™è¯¯ä¿¡æ¯å¹¶ç»ˆæ­¢ã€‚

å¦ä¸€æ–¹é¢ï¼Œå¯¹å…¨å±€ç¬¦å·çš„è§£æï¼Œç»å¸¸ä¼šé¢ä¸´å¤šä¸ªç›®æ ‡æ–‡ä»¶å¯èƒ½ä¼šå®šä¹‰ç›¸åŒåå­—çš„å…¨å±€ç¬¦å·ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œé“¾æ¥å™¨å¿…é¡»è¦ä¹ˆæ ‡å¿—ä¸€ä¸ªé”™è¯¯ï¼Œè¦ä¹ˆä»¥æŸç§æ–¹æ³•é€‰å‡ºä¸€ä¸ªå®šä¹‰å¹¶æŠ›å¼ƒå…¶ä»–å®šä¹‰ã€‚
#### å¤šé‡å®šä¹‰çš„å…¨å±€ç¬¦å·è§£æ
é“¾æ¥å™¨çš„è¾“å…¥æ˜¯ä¸€ç»„å¯é‡å®šä½ç›®æ ‡æ¨¡å—ã€‚æ¯ä¸ªæ¨¡å—å®šä¹‰ä¸€ç»„ç¬¦å·ï¼Œæœ‰äº›æ˜¯å±€éƒ¨ç¬¦å·ï¼ˆåªå¯¹å®šä¹‰è¯¥ç¬¦å·çš„æ¨¡å—å¯è§ï¼‰ï¼Œæœ‰äº›æ˜¯å…¨å±€ç¬¦å·ï¼ˆå¯¹å…¶ä»–æ¨¡å—ä¹Ÿå¯è§ï¼‰ã€‚å¦‚æœå¤šä¸ªæ¨¡å—å®šä¹‰åŒåçš„å…¨å±€ç¬¦å·ï¼Œè¯¥å¦‚ä½•è¿›è¡Œå–èˆï¼Ÿ

Linuxç¼–è¯‘ç³»ç»Ÿé‡‡ç”¨å¦‚ä¸‹çš„æ–¹æ³•è§£å†³å¤šé‡å®šä¹‰çš„å…¨å±€ç¬¦å·è§£æï¼š

**åœ¨ç¼–è¯‘æ—¶ï¼Œç¼–è¯‘å™¨æƒ³æ±‡ç¼–å™¨è¾“å‡ºæ¯ä¸ªå…¨å±€ç¬¦å·ï¼Œæˆ–è€…æ˜¯å¼ºï¼ˆstrongï¼‰æˆ–è€…æ˜¯å¼±ï¼ˆweakï¼‰ï¼Œè€Œæ±‡ç¼–å™¨æŠŠè¿™ä¸ªä¿¡æ¯éšå«åœ°ç¼–ç åœ¨å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶çš„ç¬¦å·è¡¨ä¸­ã€‚**

æ ¹æ®å¼ºå¼±ç¬¦å·çš„å®šä¹‰ï¼ŒLinuxé“¾æ¥å™¨ä½¿ç”¨ä¸‹é¢çš„è§„åˆ™æ¥å¤„ç†å¤šé‡å®šä¹‰çš„ç¬¦å·åï¼š
- **è§„åˆ™1ï¼šä¸å…è®¸æœ‰å¤šä¸ªåŒåçš„å¼ºç¬¦å·ã€‚**
- **è§„åˆ™2ï¼šå¦‚æœæœ‰ä¸€ä¸ªå¼ºç¬¦å·å’Œå¤šä¸ªå¼±ç¬¦å·åŒåï¼Œåˆ™é€‰æ‹©å¼ºç¬¦å·ã€‚**
- **è§„åˆ™3ï¼šå¦‚æœæœ‰å¤šä¸ªå¼±ç¬¦å·åŒåï¼Œåˆ™ä»è¿™äº›å¼±ç¬¦å·ä¸­ä»»æ„é€‰æ‹©ä¸€ä¸ªã€‚**

å¦ä¸€æ–¹é¢ï¼Œç”±äºå…è®¸ä¸€ä¸ªç¬¦å·å®šä¹‰åœ¨å¤šä¸ªæ–‡ä»¶ä¸­ï¼Œæ‰€ä»¥å¯èƒ½ä¼šå¯¼è‡´ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœä¸€ä¸ªå¼±ç¬¦å·å®šä¹‰åœ¨å¤šä¸ªç›®æ ‡æ–‡ä»¶ä¸­ï¼Œè€Œå®ƒä»¬çš„ç±»å‹ä¸åŒï¼Œæ€ä¹ˆåŠï¼Ÿè¿™ç§æƒ…å†µä¸»è¦æœ‰ä¸‰ç§ï¼š
- **æƒ…å†µ1ï¼šä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„å¼ºç¬¦å·ç±»å‹ä¸ä¸€è‡´ã€‚**
- **æƒ…å†µ2ï¼šæœ‰ä¸€ä¸ªå¼ºç¬¦å·ï¼Œå…¶ä»–éƒ½æ˜¯å¼±ç¬¦å·ï¼Œå‡ºç°ç±»å‹ä¸ä¸€è‡´ã€‚**
- **æƒ…å†µ3ï¼šä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šå¼±ç¬¦å·ç±»å‹ä¸ä¸€è‡´ã€‚**

å…¶ä¸­ï¼Œæƒ…å†µ1ç”±äºå¤šä¸ªå¼ºç¬¦å·å®šä¹‰æœ¬èº«å°±æ˜¯éæ³•çš„ï¼Œæ‰€ä»¥é“¾æ¥å™¨å°±ä¼šæŠ¥é”™ã€‚å¯¹äºåä¸¤ç§æƒ…å†µï¼Œç¼–è¯‘å™¨å’Œé“¾æ¥å™¨é‡‡ç”¨ä¸€ç§å«Â **COMMONå—ï¼ˆCommon Blockï¼‰**Â çš„æœºåˆ¶æ¥å¤„ç†ã€‚å…¶è¿‡ç¨‹å¦‚ä¸‹ï¼š

**é¦–å…ˆï¼Œç¼–è¯‘å™¨å°†æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡å®šä¹‰ä¸ºå¼±ç¬¦å·å¤„ç†ã€‚å¯¹äºæƒ…å†µ3ï¼Œæœ€ç»ˆé“¾æ¥æ—¶é€‰æ‹©æœ€å¤§çš„ç±»å‹ã€‚å¯¹äºæƒ…å†µ2ï¼Œæœ€ç»ˆè¾“å‡ºç»“æœä¸­çš„ç¬¦å·æ‰€å ç©ºé—´ä¸å¼ºç¬¦å·ç›¸åŒï¼Œå¦‚æœé“¾æ¥è¿‡ç¨‹ä¸­æœ‰å¼±ç¬¦å·å¤§äºå¼ºç¬¦å·ï¼Œé“¾æ¥å™¨ä¼šå‘å‡ºè­¦å‘Šã€‚**



## Relocation
> ğŸ”— https://blog.csdn.net/jinking01/article/details/105388149?fromshare=blogdetail&sharetype=blogdetail&sharerId=105388149&sharerefer=PC&sharesource=weixin_43336330&sharefrom=from_link

äº‹å®ä¸Šï¼Œé‡å®šä½è¿‡ç¨‹ä¹Ÿä¼´éšç€ç¬¦å·çš„è§£æè¿‡ç¨‹ã€‚é“¾æ¥çš„å‰ä¸¤æ­¥å®Œæˆä¹‹åï¼Œé“¾æ¥å™¨å°±å·²ç»ç¡®å®šæ‰€æœ‰ç¬¦å·çš„è™šæ‹Ÿåœ°å€äº†ï¼Œé‚£ä¹ˆé“¾æ¥å™¨å°±å¯ä»¥æ ¹æ®ç¬¦å·çš„åœ°å€å¯¹æ¯ä¸ªéœ€è¦é‡å®šä½çš„æŒ‡ä»¤è¿›è¡Œåœ°å€ä¿®æ­£ã€‚

é‚£ä¹ˆé“¾æ¥å™¨å¦‚ä½•çŸ¥é“å“ªäº›æŒ‡ä»¤æ˜¯è¦è¢«è°ƒæ•´çš„å‘¢ï¼Ÿäº‹å®ä¸Šï¼Œæˆ‘ä»¬å‰é¢æåˆ°çš„ELFæ–‡ä»¶ä¸­çš„Â **é‡å®šä½è¡¨ï¼ˆRelocation Tableï¼‰**Â ä¸“é—¨ç”¨æ¥ä¿å­˜è¿™äº›ä¸é‡å®šä½ç›¸å…³çš„ä¿¡æ¯ã€‚

å¯¹äºå¯é‡å®šä½çš„ELFæ–‡ä»¶æ¥è¯´ï¼Œå®ƒå¿…é¡»åŒ…å«é‡å®šä½è¡¨ï¼Œç”¨æ¥æè¿°å¦‚ä½•ä¿®æ”¹ç›¸åº”çš„èŠ‚çš„å†…å®¹ã€‚å¯¹äºæ¯ä¸ªè¦è¢«é‡å®šä½çš„ELFèŠ‚éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„é‡å®šä½è¡¨ã€‚å¦‚æœ`.text`èŠ‚éœ€è¦è¢«é‡å®šä½ï¼Œåˆ™ä¼šæœ‰ä¸€ä¸ªç›¸å¯¹åº”å«`.rel.text`çš„èŠ‚ä¿å­˜äº†ä»£ç èŠ‚çš„é‡å®šä½è¡¨ï¼›å¦‚æœ`.data`èŠ‚éœ€è¦è¢«é‡å®šä½ï¼Œåˆ™ä¼šæœ‰ä¸€ä¸ªç›¸å¯¹åº”çš„`.rel.tdata`çš„èŠ‚ä¿å­˜äº†æ•°æ®èŠ‚çš„é‡å®šä½è¡¨ã€‚

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨objdumpå·¥å…·æ¥æŸ¥çœ‹ç›®æ ‡æ–‡ä»¶ä¸­çš„é‡å®šä½è¡¨ï¼š

```
$ objdump -r a.o

a.o:     file format elf64-x86-64

RELOCATION RECORDS FOR [.text]:
OFFSET           TYPE              VALUE
0000000000000023 R_X86_64_32       share
0000000000000030 R_X86_64_PC32     swap-0x0000000000000004
0000000000000049 R_X86_64_PC32     __stack_chk_fail-0x0000000000000004


RELOCATION RECORDS FOR [.eh_frame]:
OFFSET           TYPE              VALUE
0000000000000020 R_X86_64_PC32     .text
```

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ¯ä¸ªè¦è¢«é‡å®šä½çš„åœ°æ–¹æ˜¯ä¸€ä¸ªÂ **é‡å®šä½å…¥å£ï¼ˆRelocation Entryï¼‰**ã€‚åˆ©ç”¨æ•°æ®ç»“æ„æˆå‘˜åŒ…å«çš„ä¿¡æ¯ï¼Œå³å¯å®Œæˆé‡å®šä½ã€‚


![](../../../../../../../../../Assets/Pics/Pasted%20image%2020250329183514.png)
<small><a>https://gist.github.com/x0nu11byt3/bcb35c3de461e5fb66173071a2379779</a></small>



## Staticly Linked ELF File Loading
![|600](../../../../../Assets/Pics/Pasted%20image%2020250329172821.png)
<small><a>https://blog.csdn.net/jinking01/article/details/105388577?fromshare=blogdetail&sharetype=blogdetail&sharerId=105388577&sharerefer=PC&sharesource=weixin_43336330&sharefrom=from_link</a> ELF Loading Example: load_elf_binary()</small>



## ELF Execution
â†— [Program Execution (Runtime)](../../ğŸ¤¡%20Program%20Execution%20(Runtime)/Program%20Execution%20(Runtime).md)

![](../../../../../Assets/Pics/Pasted%20image%2020240925195819.png)



## Ref
