## 8086 ASM

[TOC]



## Res
â†— [OS Programming Foundation](../../../../ğŸ¥·ğŸ¼%20Operating%20System%20(Tech)/ğŸ“Ÿ%20OS%20Level%20Programming/OS%20Programming%20Foundation.md)


ã€æ±‡ç¼–è¯­è¨€ä»0å¼€å§‹ é‡åˆ¶ç‰ˆ è‡ªå­¦å¿…å¤‡(é…å¥—ç‹çˆ½æ±‡ç¼–è¯­è¨€ç¬¬ä¸‰ç‰ˆæˆ–ç¬¬å››ç‰ˆ)ã€‘ https://www.bilibili.com/video/BV1mt411R7Xv/?p=8&share_source=copy_web&vd_source=7740584ebdab35221363fc24d1582d9d





## 8086 CPU Overview
#TODO 



## Data & Instructions
â†— [von Neumann-Based Architecture /Memory](../../../../ğŸ§¬%20Computer%20System/Computer%20Architecture/Computer%20Microarchitectures%20(Computer%20Organization)/Computer%20Memory/Computer%20Memory.md)



## â›¸ï¸ Data Access
### Bus
![](../../../../../../../Assets/Pics/Screenshot%202023-03-05%20at%2010.19.55%20AM.png)

As in â†— [von Neumann Based Architectures /Bus](../../../../ğŸ§¬%20Computer%20System/Computer%20Architecture/Computer%20Microarchitectures%20(Computer%20Organization)/ğŸ§ğŸ»â€â™€ï¸%20von%20Neumann%20Based%20Microarchitecture/Datapath%20(Bus)/Datapath%20(Bus).md)

### Memory & Memory Address Space
As is â†— [von Neumann Based Architectures /Memory](../../../../ğŸ§¬%20Computer%20System/Computer%20Architecture/Computer%20Microarchitectures%20(Computer%20Organization)/Computer%20Memory/Computer%20Memory.md)


### Physical Address Expression
#### Segment Address (æ®µåœ°å€)


#### Offset Addressï¼ˆåç§»åœ°å€ï¼‰

![](../../../../../../../Assets/Pics/Screenshot%202023-03-05%20at%2011.20.42%20AM.png)

![](../../../../../../../Assets/Pics/Screenshot%202023-03-05%20at%2011.25.44%20AM.png)

> â€œæ®µåœ°å€x16+åç§»åœ°å€=ç‰©ç†åœ°å€â€ çš„æœ¬è´¨å«ä¹‰æ˜¯:CPU åœ¨è®¿é—®å†…å­˜æ—¶ï¼Œç”¨ä¸€ä¸ªåŸºç¡€åœ°å€(æ®µåœ°å€x10)å’Œä¸€ä¸ªç›¸å¯¹äºåŸºç¡€åœ°å€çš„åç§»åœ°å€ç›¸åŠ ï¼Œç»™å‡ºå†…å­˜å•å…ƒçš„ç‰©ç†åœ°å€ã€‚
> æ›´ä¸€èˆ¬åœ°è¯´ï¼Œ8086CPU çš„è¿™ç§å¯»å€åŠŸèƒ½æ˜¯â€œåŸºç¡€åœ°å€+åç§»åœ°å€=ç‰©ç†åœ°å€â€ å¯»å€æ¨¡å¼çš„ä¸€ç§å…·ä½“å®ç°æ–¹æ¡ˆã€‚8086CPU ä¸­ï¼Œæ®µåœ°å€x16 å¯çœ‹ä½œæ˜¯åŸºç¡€åœ°å€ã€‚


### Data Location
CPU, memory, interfaces


### Data Length



## Instruction Executions
### Instruction Transferring




## ğŸ«™ Registers

16 bits register (2 bytes, word length = 2B /16bits)

14 total registers: 
AXã€BXã€CXã€DXã€ (general registers)
SIã€DIã€SPã€BPã€ (address registers)
IPã€FR(PSW).         (control registers)
CSã€SSã€DSã€ESã€ (segment registers)

### 1ï¸âƒ£ General Register (Data Register)
AX = AH + AL
BX = BH + BL
CX = CH + CL
DX = DH + DL


![](../../../../../../../Assets/Pics/Screenshot%202023-03-05%20at%201.49.29%20PM.png)

#### AX 
> AX:é€šç”¨å¯„å­˜å™¨ï¼Œä¸»è¦ä½œä¸ºç´¯åŠ å™¨ç”¨ï¼Œæ˜¯ç®—æœ¯è¿ç®—çš„ä¸» è¦å¯„å­˜å™¨ã€‚

##### AX and Return (DOS)
Following instructions returns the program
```asm
mov ax, 4c00H
int 21H
```

##### AX + div

##### AX + mul



#### BX
> BX:é€šç”¨å¯„å­˜å™¨ï¼Œè¿˜ç”¨ä½œåŸºå€å¯„å­˜å™¨ã€‚

##### [BX] and Offset Address
In the expression of [BX], the offset is stored in register BX.


#### CX
> CX:é€šç”¨å¯„å­˜å™¨ï¼Œè¿˜ç”¨ä½œè®¡ç®—å™¨ã€‚

##### CX + loop
```asm
mov cx, idata
s:
	code segment

	code ends
loop s
```

##### CX + jcxz


#### DX
> DX:é€šç”¨å¯„å­˜å™¨ï¼Œè¿˜åœ¨åšåŒç²¾åº¦æ•°è¿ç®—æ—¶ç”¨æ¥ä¸AXä¸€ èµ·å­˜æ”¾ä¸€ä¸ª32ä½åŒå­—æ“ä½œæ•°ï¼ŒDXå­˜æ”¾é«˜å­—(é«˜16ä½)ï¼Œ AXå­˜æ”¾ä½å­—(ä½16ä½)ã€‚

##### DX + div

Dividend:
- AX - for 8 bits divisor
	- AH - remainders
	- AL - quotient
- DX + AX - for 16 bits divisor
	- DX - remainders
	- AX - quotient

Divisor: 
- 8 bits or 16 bits
- stored in a reg or memory unit

##### DX + mul



### 2ï¸âƒ£ Segment Register
CS /DS /SS /ES


> ğŸ’¡ Abount Segment, go to â†— [Data Representations & Storage in CS](../../../../ğŸ§¬%20Computer%20System/ğŸ˜¤%20Number,%20Data%20and%20Math%20in%20Digital%20Systems/Data%20Representations%20&%20Storage%20in%20CS.md)

> ä¸ºä»€ä¹ˆ8086CPUä¸æ”¯æŒå°†æ•°æ®ç›´æ¥é€å…¥æ®µå¯„å­˜å™¨çš„æ“ä½œ? è¿™å±äº8086CPU ç¡¬ä»¶è®¾è®¡çš„é—®é¢˜ï¼Œæˆ‘ä»¬åªè¦çŸ¥é“è¿™ä¸€ç‚¹å°±è¡Œäº†


#### CS 
##### CS + IP /IR
Current instruction address.


#### DS
##### DS + [address]
Current data addresss.

##### Data Segment


#### SS + SP
Current stack top address.

More about stack at â†— [Data Representations & Storage in CS](../../../../ğŸ§¬%20Computer%20System/ğŸ˜¤%20Number,%20Data%20and%20Math%20in%20Digital%20Systems/Data%20Representations%20&%20Storage%20in%20CS.md)


### 3ï¸âƒ£ Address Register
SI, DI, BP, SP

> åœ°å€å¯„å­˜å™¨æ—¢å¯ä»¥ç”¨æ¥å­˜æ”¾å†…å­˜å•å…ƒæ“ä½œæ•°çš„åç§»åœ°å€ï¼Œ ä¹Ÿå¯ä»¥ä½œä¸º16ä½çš„é€šç”¨å¯„å­˜å™¨ä½¿ç”¨ã€‚
> 
> å¦å¤–ï¼ŒåŸºå€å¯„å­˜å™¨BXã€æŒ‡ä»¤æŒ‡é’ˆå¯„å­˜å™¨IPä¹Ÿå¯ä»¥å½’ç±» ä¸ºåœ°å€å¯„å­˜å™¨ï¼Œå› ä¸ºå®ƒä»¬ä¹Ÿå¯ç”¨æ¥å­˜æ”¾å†…å­˜å•å…ƒçš„åç§»åœ°å€ã€‚


#### BX|BP + SI|DI + idata
> SI: æºå˜å€å¯„å­˜å™¨ï¼Œå¯ç”¨äºå­˜æ”¾æºç¼“å†²åŒºçš„åç§»åœ°å€ã€‚
> DI: ç›®çš„å˜å€å¯„å­˜å™¨ï¼Œå¯ç”¨äºå­˜æ”¾ç›®çš„ç¼“å†²åŒºçš„åç§»åœ°å€ã€‚
> BP: åŸºå€æŒ‡é’ˆå¯„å­˜å™¨ï¼Œç”¨äºæŒ‡å‡ºå †æ ˆåŒºåŸºåœ°å€ã€‚


DS: BX
```asm
DS: BX
[BX + SI]
[BX + DI]
[BX + SI|DI + idata]
idata[BX + SI|DI]
idata[BX][SI|DI]
```

SS: BP
```asm
SS: BP
[BP + SI]
[BP + DI]
[BP + SI|DI + idata]
idata[BP + SI|DI]
idata[BP][SI|DI]
```


#### SP
> SP: å †æ ˆæŒ‡é’ˆå¯„å­˜å™¨ï¼Œç”¨äºæŒ‡å‡ºå †æ ˆåŒºæ ˆé¡¶çš„åç§»åœ°å€ã€‚

##### SS + SP
Mentioned above.


### 4ï¸âƒ£ Control Register
IP, FR

#### IP
> æŒ‡ä»¤æŒ‡é’ˆå¯„å­˜å™¨IP(Instruction Pointer)
> 
> ç”¨æ¥å­˜æ”¾ä»£ç æ®µ(CS)ä¸­çš„åç§»åœ°å€ï¼ŒæŒ‡å‡ºå½“å‰æ­£ åœ¨æ‰§è¡ŒæŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤æ‰€åœ¨å•å…ƒçš„åç§»åœ°å€ã€‚


##### CS + IP
Mentioned above.



#### FR (PSW, Program Status Word) (Flag Register)
> æ ‡å¿—å¯„å­˜å™¨FR(Flag Register)
> 
> æ ‡å¿—å¯„å­˜å™¨FR(åˆç§°ä¸ºç¨‹åºçŠ¶æ€å­—PSWâ€”Program Status Word)å…±æœ‰æœ‰æ•ˆæ ‡å¿—ä½9ä¸ªã€‚


> 6ä¸ªçŠ¶æ€æ ‡å¿—: åæ˜ ä¸€æ¡æŒ‡ä»¤æ‰§è¡Œå®Œæˆä¹‹åçš„ç»“æœçŠ¶æ€
> - **è¿›ä½æ ‡å¿—CF (Carry)**: å½“æŒ‡ä»¤æ‰§è¡Œç»“æœçš„æœ€é«˜ä½(å­— èŠ‚ä¸ºç¬¬7ä½ï¼Œå­—ä¸ºç¬¬15ä½)äº§ç”Ÿè¿›ä½æˆ–å€Ÿä½æ—¶CF=1ï¼Œå¦ åˆ™CF=0ã€‚
> - **å¥‡å¶æ ‡å¿—PF (Parity)**: å½“æŒ‡ä»¤æ‰§è¡Œç»“æœçš„ä½8ä½ä¸­åŒ… å«å¶æ•°ä¸ªä¸º1çš„æ•°æ®ä½æ—¶PF=1ï¼Œå¦åˆ™PF=0ã€‚
> - **è¾…åŠ©è¿›ä½æ ‡å¿—AF (Assist)**: å½“æŒ‡ä»¤æ‰§è¡Œç»“æœçš„ç¬¬3ä½ (ä½4ä½)äº§ç”Ÿè¿›ä½æˆ–å€Ÿä½æ—¶AF=1ï¼Œå¦åˆ™AF=0ã€‚
> - **é›¶å€¼æ ‡å¿—ZF (Zero)**: å½“æŒ‡ä»¤æ‰§è¡Œç»“æœä¸º0æ—¶ZF=1ï¼Œ å¦åˆ™ZF=0ã€‚
> - **ç¬¦å·æ ‡å¿—SF (Sign)**: å½“æŒ‡ä»¤æ‰§è¡Œç»“æœçš„æœ€é«˜ä½ä¸º1 (å³ç¬¦å·ä½ä¸ºè´Ÿ)æ—¶SF=1ï¼Œå¦åˆ™SF=0
> - **æº¢å‡ºæ ‡å¿—OF (Overflow)**: å½“æŒ‰ç…§è¡¥ç è§£é‡Šçš„è¿ç®—å‡º ç°æº¢å‡ºæ—¶OF=1ï¼Œå¦åˆ™OF=0ã€‚
> 
> 3ä¸ªæ§åˆ¶æ ‡å¿—:
> - **å•æ­¥è·Ÿè¸ªæ ‡å¿—TF (Trap)**: TFè¢«æ¸…0æ—¶ï¼Œæ­£å¸¸è¿ç»­æ‰§è¡Œ æŒ‡ä»¤;TFè¢«ç½®1æ—¶ï¼Œå•æ­¥å·¥ä½œæ¨¡å¼ï¼Œå³æ‰§è¡Œä¸€æ¡æŒ‡ä»¤å°±æš‚åœã€‚
> - **ä¸­æ–­ä½¿èƒ½æ ‡å¿—IF (Interrupt)**: IFè¢«æ¸…0æ—¶ï¼Œä¸å…è®¸CPU å“åº”å¯å±è”½ä¸­æ–­;IFè¢«ç½®1æ—¶ï¼Œå…è®¸CPUå“åº”å¯å±è”½ä¸­æ–­ã€‚
> - **æ–¹å‘æ ‡å¿—DF (Direction)**: DFè¢«æ¸…0æ—¶ï¼Œä¸²æ“ä½œæŒ‡ä»¤æŒ‰ ç…§åœ°å€é€’å¢çš„æ–¹å‘è¿›è¡Œæ“ä½œ;DFè¢«ç½®1æ—¶ï¼Œä¸²æ“ä½œæŒ‡ä»¤æŒ‰ ç…§åœ°å€é€’å‡çš„æ–¹å‘è¿›è¡Œæ“ä½œã€‚



![](../../../../../../../Assets/Pics/Screenshot%202023-03-20%20at%208.48.05%20PM.png)





## ASM Program
### Program Compilation
#TODO 


### ğŸ· Instructions in ASM
#### ASM Instructions
![](../../../../../../../Assets/Pics/Screenshot%202023-03-05%20at%2011.05.13%20AM.png)

##### mov, add, sub, cmp

##### div, mul

##### push (f), pop(f)


##### and, or, xor

##### shr, shl

##### jmp, jcxz, loop
![](../../../../../../../Assets/Pics/Screenshot%202023-05-09%20at%2010.25.49%20AM.png)


##### call, ret(f)

##### int


#### Pseudocode
##### idata ï¼ˆimmediate dataï¼‰

##### Loop

##### Segment Prefix

##### db, dw, dd, dup
| meaning | byte length | word length |
|-|-|-|
| define byte | 1 byte | 0.5 word (8086) |
| define word | 2 byte | 1 word (8086) |
| define dword (double word) | 4 byte | 2 word (8086) |


##### X ptr (word ptr|byte ptr)

##### offset

##### nops


#### Other Notes
#TODO 


### Memory Allocation
#TODO 


### Memory Addressing
![](../../../../../../../Assets/Pics/Screenshot%202023-03-20%20at%207.56.36%20PM.png)

#### Data Location


#### Data Length


#### Direct Addressing Table
#TODO 



## Ref
[æ±‡ç¼–ä¸­çš„æ ˆå¸§ç†è§£]: https://blog.csdn.net/yhchinabest/article/details/103881857
[Stack-based memory allocation]: https://en.wikipedia.org/wiki/Stack-based_memory_allocation
[8086æ ‡å¿—å¯„å­˜å™¨ï¼ˆFlag Registerï¼‰]: https://blog.csdn.net/weixin_42109012/article/details/100148721

[åŒºåˆ†å¤„ç†å™¨çš„å­—ï¼Œå­—é•¿å’Œæ±‡ç¼–ä¸­çš„å­—ï¼ŒåŒå­—ï¼Œå››å­—]: https://blog.csdn.net/weixin_44395686/article/details/108628301