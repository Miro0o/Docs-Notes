# BIOS (Basic IO System)

[TOC]



## Res


## Intro
BIOS本身是汇编语言代码，是在16位实模式下调用INT 13H中断执行的，由于x86-64是一个高度兼容的指令集，也为了迁就BIOS的16位实模式的运行环境，所以即使现在的CPU都已是64位，如果还是在BIOS启动（基本见于09年以前的主板），在开机时仍然都是在16位实模式下执行的。16位实模式直接能访问的内存只有1MB，就算你安了4G、8G或者16G还是32G内存，到了BIOS上一律只先认前1MB。在这1MB内存中，前640K称为基本内存，后面384K内存留给开机必要硬件和各类BIOS本身使用。


### BIOS Booting Process
当按下电源开关时，电源就开始向主板和其他设备供电，这时电压还不稳定，在早期的南北桥主板上，由主板北桥向CPU发复位信号，对CPU初始化；稳定电压后复位信号便撤掉。而对于现在的单南桥主板，则由CPU自身调整稳定电压达到初始化的目的，当电压稳定后，CPU便在系统BIOS保留的内存地址处执行跳转BIOS起始处指令，开始执行POST自检。

在POST自检中，BIOS只检查系统的必要核心硬件是否有问题，主要是CPU、640K基本内存、显卡是否正常，PS/2键盘控制器、系统时钟是否有错误等等。由于POST检查在显卡初始化以前，因此在这个阶段如发生错误，是无法在屏幕上显示的，不过主板上还有个报警扬声器，而且如果主板的8255外围可编程接口芯片没有损坏的话，POST报警声音一定是会出来的。可以根据报警声的不同大致判断错误所在，一般情况下，一声短“嘀”声基本代表正常启动，不同的错误则是不同的短“嘀”声和长“嘀”声组合。POST自检结束后，BIOS开始调用中断完成各种硬件初始化工作。

硬件初始化工作中，主要说明两点:
- 首先经过POST检测后，电脑终于出现了开机启动画面，这就是已经检测到了显卡并完成了初始化。但是请注意，由于BIOS是在16位实模式运行，因此该画面是以VGA分辨率（640\*480，纵横比4:3）显示的，因为实模式最高支持的就是VGA。以前的小14-17寸CRT显示器由于都是4:3比例，最高分辨率也比较低，因此这个开机启动画面没有什么违和感，但现在的液晶显示器基本上都是宽屏16:9的，分辨率也较高，因此在这样的显示屏下，启动画面上的一切东西显示都可以说“惨不忍睹”——图形被拉长，字体很大很模糊，可以很明显看到显示字体的锯齿。
- 第二，BIOS只识别到由主引导记录（MBR）初始化的硬盘，之所以说明这点，是因为后续的EFI或UEFI采用了一种新的GUID磁盘分区系统（GPT）格式，这种硬盘在BIOS下是无法识别的。硬件全部初始化完毕后，接下来进入更新ESCD阶段。

在ESCD更新阶段中，BIOS将对存储在CMOS中和操作系统交换的硬件配置数据进行检测，如果系统硬件发生变动，则会更新该数据，否则不更新保持原状不变，ESCD检测或更新结束后，BIOS将完成最后一项工作，就是启动操作系统。

最后这一步中，BIOS根据CMOS中用户指定的硬件启动顺序，读取相应设备的启动或引导记录，引导相应设备上的操作系统启动，进入操作系统，此后便由操作系统接替BIOS负责硬件和软件间的相互通信。如果发现所有硬件都没有能引导操作系统的记录，则会在屏幕上显示相应错误信息，并将电脑维持在16位实模式。


### BIOS -> EFI -> UEFI
虽然BIOS作为电脑加电启动所必不可少的部分，但是从其于1975年诞生之日起近30余年，16位汇编语言代码，1M内存寻址，调用中断一条条执行的理念和方式竟然一点都没有改变，虽然经各大主板商不懈努力，BIOS也有了ACPI、USB设备支持，PnP即插即用支持等新东西，但是这在根本上没有改变BIOS的本质，而英特尔为了迁就这些旧技术，不得不在一代又一代处理器中保留着16位实模式（否则根本无法开机的）。但是，英特尔在2001年开发了全新的安腾处理器，采用IA-64架构，并推出了全新的EFI。后来证明，安腾处理器、IA-64架构没有推广开来，而EFI和后继的UEFI却发扬光大，成为现在电脑的主要预启动环境。

> Continue with ↗ [EFI (Extensible Firmware Interface)](../EFI%20&%20UEFI%20(Unified%20Extensible%20Firmware%20Interface)/EFI%20(Extensible%20Firmware%20Interface).md)
> or at ↗ [UEFI (Unified Extensible Firmware Interface)](../EFI%20&%20UEFI%20(Unified%20Extensible%20Firmware%20Interface)/UEFI%20(Unified%20Extensible%20Firmware%20Interface).md)



## Ref
👍 电脑基础知识普及：BIOS、EFI与UEFI详解！ - 知乎用户fB10GU的文章 - 知乎 https://zhuanlan.zhihu.com/p/54108702


