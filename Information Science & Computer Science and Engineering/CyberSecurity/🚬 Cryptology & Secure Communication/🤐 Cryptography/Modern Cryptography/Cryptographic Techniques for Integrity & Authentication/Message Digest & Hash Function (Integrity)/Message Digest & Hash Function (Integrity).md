# Message Digest & Hash Function (Integrity)

[TOC]



## Res
### Related Topics
â†— [MD Cryptanalysis](../../../../ğŸ¤®%20Cryptanalysis/Modern%20Cipher%20Cryptanalysis/MD%20Cryptanalysis/MD%20Cryptanalysis.md)
â†— [Login Cracker & Password Cracker](../../../../../â˜ ï¸%20Kill%20Chain%20&%20Security%20Tool%20Box/Credentials%20&%20Password%20Related%20Tools/Login%20Cracker%20&%20Password%20Cracker/Login%20Cracker%20&%20Password%20Cracker.md)
- â†— [hashcat](../../../../../â˜ ï¸%20Kill%20Chain%20&%20Security%20Tool%20Box/Credentials%20&%20Password%20Related%20Tools/Login%20Cracker%20&%20Password%20Cracker/hashcat.md)


### Other Resources



## Intro
Hash function:
- Map arbitrary-length input to fixed-length output
- Output is deterministic and unpredictable
- Security properties
	- One way: Given an output y, it is infeasible to find any input x such that $H(x) = y$.
	- Second preimage resistant: Given an input x, it is infeasible to find another input $x' \neq x$ such that $H(x) = H(x')$.
	- Collision resistant: It is infeasible to find another any pair of inputs $x' \neq x$ such that $H(x) = H(x')$.
- Some hashes are vulnerable to length extension attacks $(H(M) â†’ H(M||Mâ€™))$
- Hashes donâ€™t provide integrity (unless you can publish the hash securely)


### Hash Function Properties
è®¾æ•£åˆ—å‡½æ•°ä¸º$h(m)$ï¼Œå…·æœ‰ä»¥ä¸‹åŸºæœ¬ç‰¹æ€§:  
(1) $h(m)$ç®—æ³•å…¬å¼€ï¼Œä¸éœ€è¦å¯†é’¥ã€‚  
(2) å…·æœ‰æ•°æ®å‹ç¼©åŠŸèƒ½ï¼Œå¯å°†ä»»æ„é•¿åº¦çš„è¾“å…¥æ•°æ®è½¬æ¢æˆä¸€ä¸ªå›ºå®šé•¿åº¦çš„è¾“å‡ºã€‚
(3) å¯¹ä»»ä½•ç»™å®šçš„mï¼Œ$h(m)$æ˜“äºè®¡ç®—ã€‚

é™¤æ­¤ä¹‹å¤–ï¼Œæ•£åˆ—å‡½æ•°è¿˜å¿…é¡»æ»¡è¶³ä»¥ä¸‹å®‰å…¨æ€§è¦æ±‚:  
(1) å…·æœ‰**å•å‘æ€§**ã€‚
ç»™å®šæ¶ˆæ¯çš„æ•£åˆ—å€¼ $h(m)$ï¼Œè¦å¾—åˆ°æ¶ˆæ¯ $m$ åœ¨è®¡ç®—ä¸Šä¸å¯è¡Œ;  
(2) å…·æœ‰**å¼±æŠ—ç¢°æ’æ€§(Weak collision resistance)**ã€‚
ä¹Ÿç§°å¼±æŠ—å†²çªæ€§ï¼šå¯¹ä»»ä½•ç»™å®šçš„æ¶ˆæ¯ $m$ï¼Œå¯»æ‰¾ä¸$m$ä¸åŒçš„æ¶ˆæ¯ $mâ€™$ï¼Œä½¿å¾—å®ƒä»¬çš„æ•£åˆ—å€¼ç›¸åŒï¼Œå³ $h(mâ€™)=h (m)$ï¼Œåœ¨è®¡ç®—ä¸Šä¸å¯è¡Œã€‚  
(3) å…·æœ‰**å¼ºæŠ—ç¢°æ’æ€§(Strong collision resistance)** ã€‚
ä¹Ÿç§°å¼ºæŠ—å†²çªæ€§:å¯»æ‰¾ä»»æ„ä¸¤ä¸ªä¸åŒçš„æ¶ˆæ¯ $m$ å’Œ $mâ€™$ï¼Œ ä½¿å¾— $h(m)=h(mâ€™)$ åœ¨è®¡ç®—ä¸Šä¸å¯è¡Œã€‚  

æ‰€è°“æ•£åˆ—å‡½æ•°çš„ç¢°æ’æ˜¯æŒ‡è‹¥ä¸¤ä¸ªæ¶ˆæ¯ $m$ ä¸ $mâ€™$ï¼Œ$m \neq mâ€™$ ï¼Œä½†å®ƒä»¬çš„æ•£åˆ—å€¼ç›¸ç­‰ï¼Œå³ $h(m) = h(mâ€™)$ï¼Œé‚£ä¹ˆï¼Œåˆ™æŠŠè¿™ç§æƒ…å†µç§°ä¸ºå‘ç”Ÿäº†**ç¢°æ’æˆ–å†²çª**ã€‚

ç”±äºè¾“å…¥æ¶ˆæ¯çš„é•¿åº¦å¯ä»¥æ˜¯ä»»æ„çš„ï¼Œä½†æ•£åˆ—å‡½æ•°è¾“å‡ºçš„æ•£åˆ—å€¼çš„é•¿åº¦æ˜¯å›ºå®šçš„ï¼Œå¦‚å¯¹äºæ•£åˆ—å€¼é•¿åº¦ä¸º 160 ä½çš„æ•£åˆ—å‡½æ•°è€Œè¨€ï¼Œå¯èƒ½çš„æ•£åˆ—å€¼æ€»æ•°ä¸º 2160ã€‚æ˜¾ç„¶ï¼Œä¸åŒçš„æ¶ˆæ¯å°±æœ‰å¯èƒ½ä¼šäº§ç”Ÿç›¸åŒçš„æ•£åˆ—å€¼ï¼Œå³æ•£åˆ—å‡½æ•°å…·æœ‰ç¢°æ’çš„**ä¸å¯é¿å…æ€§**ã€‚

ä½†æ˜¯ï¼Œæ•£åˆ—ç®—æ³•çš„**å®‰å…¨æ€§**è¦æ±‚æ‰¾åˆ°ä¸€ä¸ªç¢°æ’åœ¨è®¡ç®—ä¸Šæ˜¯ä¸å¯è¡Œçš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¦æ±‚ç¢°æ’æ˜¯ä¸å¯é¢„æµ‹çš„ï¼Œæ”»å‡»è€…ä¸èƒ½æŒ‡æœ›å¯¹è¾“å…¥ æ¶ˆæ¯çš„é¢„æœŸæ”¹å˜å¯ä»¥å¾—åˆ°ä¸€ä¸ªç›¸åŒçš„æ•£åˆ—å€¼ã€‚

å“ˆå¸Œå‡½æ•°æœ¬èº«èƒ½å¦æä¾›å®Œæ•´æ€§ä¿æŠ¤ï¼Ÿï¼ˆintegrityï¼‰
- å–å†³äºå…¶ä»–å› ç´ ï¼ˆæ˜¯å¦ç¡®ä¿ä¸è¢«ç¯¡æ”¹/authenticityï¼‰


### Hash Function Applications
æ•£åˆ—å‡½æ•°çš„ä¸»è¦åº”ç”¨æœ‰ä»¥ä¸‹ä¸‰ä¸ªæ–¹é¢:
(1)ä¿è¯æ•°æ®çš„**å®Œæ•´æ€§** 
ä¾‹å¦‚ï¼Œä¸ºä¿è¯æ•°æ®æˆ–æ–‡ä»¶çš„å®Œæ•´æ€§ï¼Œå¯ä»¥ä½¿ç”¨æ•£åˆ—å‡½æ•°å¯¹æ•°æ®æˆ–æ–‡ä»¶ç”Ÿæˆå…¶æ•£åˆ—ç ï¼Œå¹¶åŠ ä»¥å®‰å…¨ä¿å­˜ï¼Œç„¶åï¼Œæ¯å½“ä½¿ç”¨æ•°æ®æˆ–æ–‡ä»¶æ—¶ï¼Œç”¨æˆ·å¯ä½¿ç”¨æ•£åˆ—å‡½æ•°é‡æ–°è®¡ç®—å…¶æ•£åˆ—ç ï¼Œå¹¶ä¸ä¿å­˜çš„æ•£åˆ—ç è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœç›¸ç­‰ï¼Œè¯´æ˜æ•°æ®æ˜¯å®Œæ•´çš„ï¼Œæ²¡æœ‰ç»è¿‡æ”¹åŠ¨;å¦åˆ™ï¼Œæ•°æ®è¡¨ç¤ºå·²ç»è¢«ç¯¡æ”¹è¿‡ã€‚è¿™æ ·ï¼Œå¯å‘ç°ç—…æ¯’æˆ–å…¥ä¾µè€…å¯¹ç¨‹åºæˆ–æ–‡æ¡£çš„éæˆæƒåœ°ç¯¡æ”¹ã€‚

(2)**å•å‘æ•°æ®åŠ å¯†** 
åº”ç”¨äºè¯¸å¦‚ç”¨æˆ·å£ä»¤åŠ å¯†ç­‰åœºåˆã€‚å°†ç”¨æˆ·å£ä»¤çš„æ•£åˆ—ç å­˜æ”¾åˆ°ä¸€ä¸ªå£ä»¤è¡¨ä¸­ï¼Œä½¿ç”¨æ—¶å°†ç”¨æˆ·è¾“å…¥çš„å£ä»¤è¿›è¡Œç›¸åº”æ•£åˆ—è¿ç®—åï¼Œå†ä¸å£ä»¤è¡¨ä¸­å¯¹åº”ç”¨æˆ·çš„å£ä»¤æ•£åˆ—ç æ¯”è¾ƒï¼Œä»è€Œå®Œæˆå£ä»¤çš„æœ‰æ•ˆæ€§éªŒè¯ï¼Œ è¿™ç§æ–¹å¼å¯é¿å…ä»¥æ˜æ–‡çš„å½¢å¼ä¿å­˜ç”¨æˆ·å£ä»¤ï¼Œä¹Ÿæ— éœ€è§£å¯†è¿ç®—ï¼Œå¢å¼ºäº†ç”¨æˆ·å£ä»¤çš„å®‰å…¨æ€§ï¼Œè¿™ç§å•å‘æ•° æ®åŠ å¯†è‡³ä»Šä»ç„¶åœ¨è®¸å¤šä¿¡æ¯ç³»ç»Ÿä¸­å¾—åˆ°å¹¿æ³›ä½¿ç”¨ã€‚

(3)**æ•°å­—ç­¾å**
å°†æ•£åˆ—å‡½æ•°åº”ç”¨äºæ•°å­—ç­¾åå¯ä»¥æé«˜é«˜ç­¾åçš„é€Ÿåº¦ï¼Œä¸æ³„éœ²æ•°å­—ç­¾åæ‰€å¯¹åº”çš„åŸå§‹æ¶ˆæ¯ï¼Œè€Œä¸”è¿˜å¯ä»¥å°†æ¶ˆæ¯çš„ç­¾åå˜æ¢ä¸åŠ å¯†å˜æ¢åˆ†å¼€å¤„ç†ï¼Œå› æ­¤æ•£åˆ—å‡½æ•°åœ¨æ•°å­—ç­¾åä¸­å¾—åˆ°æ™®éåº”ç”¨ã€‚

â†— [Digital Signature & DSA](../Message%20Authentication%20(æŠ¥æ–‡é‰´åˆ«ï¼Œæ¶ˆæ¯é‰´åˆ«)/Digital%20Signature%20&%20DSA/Digital%20Signature%20&%20DSA.md)


### Hash Function Threats
Birthday attack:

Length extension attack:
- Given H(x) and the length of x, but not x, an attacker can create H(x || m) for any m of the attackerâ€™s choosing
	- See homework for a demo
	- Note: This doesnâ€™t violate any property of hash functions but is undesirable in some circumstances
- SHA-256 (256-bit version of SHA-2) is vulnerable    
- SHA-3 is not vulnerable



## Hash Function Principles
### Iterative Message Digest Models


### Design Principles of Message Digest
#### 1ï¸âƒ£ Asymmetric Cipher Based Design
![](../../../../../../../Assets/Pics/Screenshot%202023-05-21%20at%201.32.35%20PM.png)

å¯¹äºæ¶ˆæ¯ $M=(m_1ï¼Œm_2ï¼Œm_3......m_t)$ï¼Œè¿™æ—¶æ•£åˆ—å‡½æ•°çš„é€»è¾‘å…³ç³»å¯è¡¨ç¤ºä¸º: 
$$
\begin{align}
& c_0=IV; \\
& c_i=E_{PK}(m_i \oplus c_{i-1}) ; \ 1â‰¤iâ‰¤t ; \\
& h(M)= c_t
\end{align}
$$
å¦‚æœä¸¢å¼ƒç”¨æˆ·çš„ç§é’¥ $S_K$ï¼Œè¿™æ—¶äº§ç”Ÿçš„æ•£åˆ—å€¼å°†æ— æ³•è§£å¯†ï¼Œå®ƒæ»¡è¶³äº†æ•£åˆ—å‡½æ•°çš„å•å‘æ€§è¦æ±‚ã€‚ è™½ç„¶åœ¨åˆç†çš„å‡è®¾ä¸‹ï¼Œå¯ä»¥è¯æ˜è¿™ç±»æ•£åˆ—å‡½æ•°æ˜¯å®‰å…¨çš„ï¼Œç”±äºå®ƒçš„è®¡ç®—æ•ˆç‡å¤ªä½ï¼Œæ‰€ä»¥è¿™ä¸€ç±»æ•£åˆ—å‡½æ•°å¹¶æ²¡æœ‰ä»€ä¹ˆå®ç”¨ä»·å€¼ã€‚
#### 2ï¸âƒ£ Symmetric Block Cipher Based Design
é€šå¸¸ï¼Œå¯ä»¥ä½¿ç”¨å¯¹ç§°å¯†é’¥åˆ†ç»„å¯†ç ç®—æ³•çš„ CBC æ¨¡å¼æˆ– CFB æ¨¡å¼æ¥äº§ç”Ÿæ•£åˆ—å€¼ï¼Œå¦‚å›¾ 5.4ã€å›¾ 5.5 æ‰€ç¤ºã€‚å®ƒå°†ä½¿ç”¨ä¸€ä¸ªå¯¹ç§°å¯†é’¥ k åŠåˆå§‹å˜é‡ IV åŠ å¯†åˆ†ç»„æ¶ˆæ¯ï¼Œå¹¶å°†æœ€åçš„å¯†æ–‡åˆ†ç»„ä½œä¸ºæ•£åˆ—å€¼è¾“å‡ºã€‚ è¿™æ—¶ï¼Œå¦‚æœåˆ†ç»„ç®—æ³•æ˜¯å®‰å…¨çš„ï¼Œé‚£ä¹ˆæ•£åˆ—å‡½æ•°ä¹Ÿå°†æ˜¯å®‰å…¨çš„ã€‚

![](../../../../../../../Assets/Pics/Screenshot%202023-05-21%20at%201.32.56%20PM.png)
##### Attacks to Symmetric Block Cipher Based MD
åŸºäºåˆ†ç»„å¯†ç çš„ CBC å·¥ä½œæ¨¡å¼å’Œ CFB å·¥ä½œæ¨¡å¼çš„æ•£åˆ—å‡½æ•°ä¸­ï¼Œå¯†é’¥ k ä¸èƒ½å…¬å¼€ã€‚å¦‚æœå¯†é’¥ k å…¬å¼€ï¼Œåˆ™ä¼šä½¿å¾—æ”»å‡»è€…æ„é€ æ¶ˆæ¯ç¢°æ’ååˆ†å®¹æ˜“ï¼Œä¸‹é¢ä»¥ CBC æ¨¡å¼ä¸ºä¾‹è¿›è¡Œåˆ†æã€‚  
å¦‚å›¾ 5.6 æ‰€ç¤ºï¼Œåœ¨ CBC å·¥ä½œæ¨¡å¼ä¸­ï¼Œæ¶ˆæ¯ M è¢«åˆ†ä¸º t ä¸ªåˆ†ç»„ $(m_1ï¼Œm_2ï¼Œm_3......m_t)$ï¼Œç„¶ååˆ†åˆ«ç”¨å¯†é’¥ k åŠ å¯†ï¼Œå¹¶å¯¹æ¯æ¬¡è¾“å‡ºç»“æœè¿›è¡Œé“¾æ¥å¾—åˆ°æœ€åçš„æ•£åˆ—å€¼ h(M)ã€‚å¦‚æœæ”»å‡»è€…çŸ¥é“å¯†é’¥ kï¼Œä¾¿å¯ä»¥è§£å¯†è®¡ ç®—å¾—åˆ°æœ€åä¸€æ¬¡åŠ å¯†çš„è¾“å…¥ $x_t$ã€‚äºæ˜¯æ”»å‡»è€…å¯ä»¥å°†æ¶ˆæ¯ M çš„å‰ t-1 ä¸ªåˆ†ç»„ $m_1ï¼Œm_2ï¼Œm_3......m_{t-1}$ ä»»æ„ç¯¡æ”¹æˆ $mâ€™_1ï¼Œmâ€™_2ï¼Œmâ€™_3......mâ€™_{t-1}$ï¼Œå¹¶è®¡ç®—å¾—åˆ° $câ€™_{t-1}$ï¼Œå†æ„é€  $mâ€™_t= câ€™_{t-1} \oplus c_t$ï¼Œå½¢æˆç¯¡æ”¹åçš„æ¶ˆæ¯ $Mâ€™=mâ€™_1||mâ€™_2||mâ€™_3||...... ||mâ€™_{t-1}||mâ€™_t$ã€‚

![](../../../../../../../Assets/Pics/Screenshot%202023-05-21%20at%201.33.31%20PM.png)

è™½ç„¶ $M' \neq M$ï¼Œä½†æ˜¯ç”±äºå¼‚æˆ–è¿ç®—çš„æ€§è´¨ï¼Œåœ¨æ•£åˆ—å‡½æ•°è®¡ç®—çš„æœ€åä¸€æ­¥å¾—åˆ°çš„ $mâ€™_t \oplus câ€™_{t-1}=c_t$ æœªå‘ç”Ÿå˜ åŒ–ï¼Œæ‰€ä»¥ä»ç„¶æœ‰ $câ€™_t= c_t$ï¼Œå³ $h(Mâ€™)=h(M)$ï¼Œè¿™å°±é€šè¿‡è®¡ç®—é€ æˆäº†ç¢°æ’ã€‚å¯¹äº CFB æ¨¡å¼ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸åŒçš„ æ–¹æ³•ç¯¡æ”¹å¯†æ–‡é€ æˆç¢°æ’ã€‚å› æ­¤ï¼Œåœ¨å¯†é’¥å…¬å¼€çš„æƒ…å†µä¸‹ï¼ŒåŸºäºåˆ†ç»„å¯†ç çš„ CBC å·¥ä½œæ¨¡å¼å’Œ CFB å·¥ä½œæ¨¡å¼ çš„ Hash å‡½æ•°æ˜¯ä¸å®‰å…¨çš„ï¼Œå®ƒä»¬ç”šè‡³ä¸æ˜¯å¼±æŠ—ç¢°æ’çš„ã€‚åœ¨å®é™…ä½¿ç”¨ä¸­å¯†é’¥ k å¿…é¡»ä¿å¯†ï¼Œè¿™ç§å¸¦å¯†é’¥çš„æ•£ åˆ—å‡½æ•°å¸¸ç”¨äºäº§ç”Ÿæ¶ˆæ¯é‰´åˆ«ç ã€‚
#### 3ï¸âƒ£ Direct Design
è¿™ç±»æ•£åˆ—å‡½æ•°å¹¶ä¸åŸºäºä»»ä½•å‡è®¾å’Œå¯†ç ä½“åˆ¶ï¼Œå®ƒæ˜¯é€šè¿‡ç›´æ¥æ„é€ å¤æ‚çš„éçº¿æ€§å…³ç³»è¾¾åˆ°å•å‘æ€§è¦æ±‚æ¥è®¾è®¡å•å‘æ•£åˆ—å‡½æ•°ã€‚è¿™ç±»æ•£åˆ—ç®—æ³•å…¸å‹çš„æœ‰:MD2ã€MD4ã€MD5ã€SHA ç³»åˆ—ç­‰æ•£åˆ—ç®—æ³•ã€‚ç›®å‰ï¼Œç›´æ¥è®¾è®¡æ•£åˆ—å‡½æ•°çš„æ–¹æ³•å—åˆ°äº†äººä»¬çš„å¹¿æ³›å…³æ³¨å’Œé‡è§†ã€‚

â†— [SHA (Secure Hash Algorithm)](SHA%20(Secure%20Hash%20Algorithm)/SHA%20(Secure%20Hash%20Algorithm).md)
â†— [MD (Message Digest)](MD%20(Message%20Digest)/MD%20(Message%20Digest).md)



## Ref
[ğŸ‘ å“ˆå¸Œç¢°æ’ä¸ç”Ÿæ—¥æ”»å‡» | é˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿—]: https://www.ruanyifeng.com/blog/2018/09/hash-collision-and-birthday-attack.html

[Birthday attack | Wikipedia]: https://en.wikipedia.org/wiki/Birthday_attack
